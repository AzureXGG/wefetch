{"version":3,"sources":["index.js","dist/wefetch.min.js"],"names":[],"mappings":";;;;;;;AAAA;;;ACAA;AACA","file":"index.js","sourcesContent":["module.exports = require('./dist/wefetch.min.js')","!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define(t):(e=e||self).wefetch=t()}(this,function(){function e(){this.listeners={}}e.prototype.on=function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.emit=function(e,t){var n=this.listeners[e];n.length&&n.forEach(function(e){e(t)})};var i=new e;function t(r){return function(n){n=n||{};for(var e=arguments.length,o=Array(1<e?e-1:0),t=1;t<e;t++)o[t-1]=arguments[t];return new Promise(function(e,t){n.eventType?i.emit(n.eventType,r.apply(void 0,[Object.assign({},n,{success:e,fail:t})].concat(o))):r.apply(void 0,[Object.assign({},n,{success:e,fail:t})].concat(o))})}}function n(){this.platform=null}n.prototype.getRequest=function(){try{if(wx.request)return this.platform=\"wechat\",t(wx.request)}catch(e){try{if(my.httpRequest)return this.platform=\"ali\",t(my.httpRequest)}catch(e){if(swan.request)return this.platform=\"swan\",t(swan.request)}}},n.prototype.getUpload=function(){return\"wechat\"===this.platform?t(wx.uploadFile):\"ali\"===this.platform?t(my.uploadFile):\"swan\"===this.platform?t(swan.uploadFile):void 0},n.prototype.getDownload=function(){return\"wechat\"===this.platform?t(wx.downloadFile):\"ali\"===this.platform?t(my.downloadFile):\"swan\"===this.platform?t(swan.downloadFile):void 0};var o=new n,r=\"multipart/form-data\",u=\"image/jpeg\",a={createRequest:o.getRequest(),header:{\"Content-Type\":\"application/x-www-form-urlencoded;charset=utf-8\"},timeout:0};function l(o,r){return function(){for(var e=new Array(arguments.length),t=0,n=e.length;t<n;t++)e[t]=arguments[t];return o.apply(r,e)}}var s=Object.prototype.toString,f={type:function(){for(var e={},t=[\"String\",\"Object\",\"Number\",\"Array\",\"Undefined\",\"Function\",\"Null\",\"Date\"],n=0,o=t.length;n<o;n++)!function(t){e[\"is\"+t]=function(e){return s.call(e)===\"[object \"+t+\"]\"}}(t[n]);return e}(),forEach:function(e,t){if(e)if(\"object\"!=typeof e&&(e=[e]),Array.isArray(e))for(var n=0,o=e.length;n<o;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)},merge:function(){var n={};function e(e,t){\"object\"==typeof n[t]&&\"object\"==typeof e?n[t]=f.merge(n[t],e):n[t]=e}for(var t=0,o=arguments.length;t<o;t++)this.forEach(arguments[t],e);return n},extends:function(n,e,o){return this.forEach(e,function(e,t){n[t]=o&&\"function\"==typeof e?l(e,o):e}),n}};function h(){this.handles=[]}function c(e){return(0,e.createRequest)(e).then(function(e){return e},function(e){return Promise.reject(e)})}function p(e){this.defaults=e,this.before=new h,this.after=new h,this.events={},this.on=function(e,t){e in this.events?console.error(\"You cannot register the same eventType multiple times\"):(i.on(e,t),this.events[e]=t)}}function d(e){var t=new p(e),n=l(p.prototype.request,t);return f.extends(n,p.prototype,t),f.extends(n,t),n}h.prototype.use=function(e,t){return this.handles.push({fulfilled:e,rejected:t}),this.handles.length-1},h.prototype.eject=function(e){this.handles[e]&&(this.handles[e]=null)},h.prototype.forEach=function(t){this.handles.forEach(function(e){e&&t(e)})},[\"options\",\"get\",\"head\",\"post\",\"put\",\"delete\",\"trace\",\"connect\",\"postJson\"].forEach(function(o){p.prototype[o]=function(e,t,n){return this.request(f.merge(n||{},{url:e,data:t,method:o,config:n}))}}),p.prototype.download=function(e,t,n){return t=t||{},(n=n||{}).createRequest=o.getDownload(),n.header?n.header[\"Content-Type\"]=n.header[\"Content-Type\"]||u:n.header={\"Content-Type\":u},f.type.isObject(e)?this.request(f.merge(n,e,{url:e.url?e.url:\"\",filePath:e.filePath,method:\"download\"})):this.request(f.merge(n,{url:e,filePath:t?t.filePath:void 0,config:n,method:\"download\"}))},p.prototype.upload=function(e,t,n){return t=t||{},(n=n||{}).createRequest=o.getUpload(),n.header?n.header[\"Content-Type\"]=n.header[\"Content-Type\"]||r:n.header={\"Content-Type\":r},f.type.isObject(e)?this.request(f.merge(n,e,{url:e.url?e.url:\"\",method:\"upload\",filePath:e.filePath,name:e.name,fileType:e.fileType,formData:e.formData})):this.request(f.merge(n,{url:e,method:\"upload\",filePath:t.filePath,name:t.name,formData:t.formData,fileType:t.fileType,config:n}))},p.prototype.promisify=t,p.prototype.request=function(e){if(void 0!==e.url&&null!==e.url){\"postJson\"===(e=f.merge(this.defaults,{method:\"get\"},e)).method&&(e.method=\"post\",e.header[\"Content-Type\"]=\"application/json;charset=utf-8\"),-1===e.url.indexOf(\"http\")&&(e.downloadUrl&&\"download\"===e.method?e.url=e.downloadUrl+e.url:e.uploadUrl&&\"upload\"===e.method?e.url=e.uploadUrl+e.url:e.url=e.baseUrl+e.url),\"download\"===e.method&&(e.method=\"get\"),\"upload\"===e.method&&(e.method=\"post\");var t=[c,void 0],n=Promise.resolve(e);for(this.before.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.after.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)n=n.then(t.shift(),t.shift());return n}console.error(\"the request url is undefined\")},Promise.prototype.finally=function(t){var n=this.constructor;return this.then(function(e){n.resolve(t(e)).then(function(){return e})},function(e){n.resolve(t(value)).then(function(){return Promise.reject(e)})})};var m=d(a);return m.all=function(e){return Promise.all(e)},m.create=function(e){return d(f.merge(a,e))},m});\n"]}